name: Check if newly added TeX files is compilable
on: [pull_request, issue_comment]
jobs:
  get_changed_files:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      
      - name: Get changed files
        id: changed-files
        uses: tj-actions/changed-files@v23.1
        with:
          files: |
            **/*.tex
            
  compile_new_tex_files:
    runs-on: ubuntu-latest
    needs: get_changed_files
    if: "${{ steps.changed-files.outputs.all_changed_files != '' }}"
    steps:
      - name: Compile changed LaTeX files
        id: compile_tex
        uses: xu-cheng/latex-action@v2
        with:
          root_file: ${{ steps.changed-files.outputs.all_changed_files }}
          extra_fonts: |
            ./fonts/*.ttf
            ./fonts/*.otf
          latexmk_use_xelatex: true
        env:
          TEXINPUTS: "./"
